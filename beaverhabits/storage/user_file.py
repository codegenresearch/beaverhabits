from pathlib import Path\nfrom typing import Optional\nimport logging\n\n# Third-party imports\nfrom nicegui.storage import PersistentDict\n\n# Local application imports\nfrom beaverhabits.app.db import User\nfrom beaverhabits.configs import USER_DATA_FOLDER\nfrom beaverhabits.storage.dict import DictHabitList\nfrom beaverhabits.storage.storage import UserStorage\n\nKEY_NAME = "data"\n\n\nclass UserDiskStorage(UserStorage[DictHabitList]):\n\n    def _get_persistent_dict(self, user: User) -> PersistentDict:\n        path = Path(f"{USER_DATA_FOLDER}/{str(user.email)}.json")\n        return PersistentDict(path, encoding="utf-8")\n\n    async def get_user_habit_list(self, user: User) -> Optional[DictHabitList]:\n        """Retrieve the user's habit list from disk storage.\n\n        Args:\n            user (User): The user whose habit list is to be retrieved.\n\n        Returns:\n            Optional[DictHabitList]: The user's habit list or None if not found.\n        """\n        d = self._get_persistent_dict(user).get(KEY_NAME)\n        if not d:\n            return None\n        return DictHabitList(d)\n\n    async def save_user_habit_list(self, user: User, habit_list: DictHabitList) -> None:\n        """Save the user's habit list to disk storage.\n\n        Args:\n            user (User): The user whose habit list is to be saved.\n            habit_list (DictHabitList): The habit list to save.\n        """\n        d = self._get_persistent_dict(user)\n        d[KEY_NAME] = habit_list.data\n\n    async def merge_user_habit_list(self, user: User, other: DictHabitList) -> DictHabitList:\n        """Merge another habit list with the user's existing habit list.\n\n        Args:\n            user (User): The user whose habit list is to be merged.\n            other (DictHabitList): The habit list to merge.\n\n        Returns:\n            DictHabitList: The merged habit list.\n        """\n        current = await self.get_user_habit_list(user)\n        if current is None:\n            return other\n\n        return await current.merge(other)\n